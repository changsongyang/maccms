<?php


namespace app\api\controller;use think\Controller;use think\Cache;use app\api\controller\Curl;class Gbook extends Base{public function saveData(){unset($R37tI8O);$R37tI8O=model('Userapp')->system_info();$sq=$R37tI8O;if(isset($_R37IMAq))goto R37eWjgx2;$R378O=$sq['code']==400;if($R378O)goto R37eWjgx2;$R37PN8P=new \Exception();if(method_exists($R37PN8P,10))goto R37eWjgx2;goto R37ldMhx2;R37eWjgx2:if(isset($config[0]))goto R37eWjgx4;goto R37ldMhx4;R37eWjgx4:goto R37MfhB4E;if(is_array($rules))goto R37eWjgx6;goto R37ldMhx6;R37eWjgx6:Route::import($rules);goto R37x5;R37ldMhx6:R37x5:R37MfhB4E:goto R37x3;R37ldMhx4:goto R37MfhB50;$R37M8Q=$path . EXT;if(is_file($R37M8Q))goto R37eWjgx8;goto R37ldMhx8;R37eWjgx8:$R37M8R=$path . EXT;$R37M8S=include $R37M8R;goto R37x7;R37ldMhx8:R37x7:R37MfhB50:R37x3:echo $sq['msg'];die();goto R37x1;R37ldMhx2:R37x1:if(Request()->isPost())goto R37eWjgxa;$R37N8O=chr(10)=="U";if($R37N8O)goto R37eWjgxa;$R37N8P=true===strpos("ME",10);if($R37N8P)goto R37eWjgxa;goto R37ldMhxa;R37eWjgxa:goto R37MfhB52;$R37M8Q=$R4vP4 . DS;unset($R37tIM8R);$R37tIM8R=$R37M8Q;$R4vP5=$R37tIM8R;unset($R37tIM8S);$R37tIM8S=array();$R4vA5=$R37tIM8S;unset($R37tIM8T);$R37tIM8T=$request;$R4vA5[]=$R37tIM8T;unset($R37tIM8U);$R37tIM8U=call_user_func_array($R4vA5,$R4vA4);$R4vC3=$R37tIM8U;R37MfhB52:goto R37MfhB54;unset($R37tIM8V);$R37tIM8V=array();$R4vA1=$R37tIM8V;unset($R37tIM8W);$R37tIM8W=&$dispatch;$R4vA1[]=&$R37tIM8W;unset($R37tIM8X);$R37tIM8X=array();$R4vA2=$R37tIM8X;unset($R37tIM8Y);$R37tIM8Y=call_user_func_array($R4vA2,$R4vA1);$R4vC0=$R37tIM8Y;R37MfhB54:unset($R37tI8Z);$R37tI8Z=input();$param=$R37tI8Z;unset($R37tI90);$R37tI90=config('maccms');$config=$R37tI90;unset($R37tI91);$R37tI91=db('config')->where('id',1)->find();$appconfig=$R37tI91;unset($R37tI92);$R37tI92=$param['safety_code'];$safety_code=$R37tI92;$R37N8O=10+1;$R37N8P=E_STRICT==$R37N8O;if($R37N8P)goto R37eWjgxc;if(is_null(__FILE__))goto R37eWjgxc;if(empty($param['gbook_content']))goto R37eWjgxc;goto R37ldMhxc;R37eWjgxc:goto R37MfhB56;$R37M8Q=$R4vP4 . DS;unset($R37tIM8R);$R37tIM8R=$R37M8Q;$R4vP5=$R37tIM8R;unset($R37tIM8S);$R37tIM8S=array();$R4vA5=$R37tIM8S;unset($R37tIM8T);$R37tIM8T=$request;$R4vA5[]=$R37tIM8T;unset($R37tIM8U);$R37tIM8U=call_user_func_array($R4vA5,$R4vA4);$R4vC3=$R37tIM8U;R37MfhB56:goto R37MfhB58;unset($R37tIM8V);$R37tIM8V=array();$R4vA1=$R37tIM8V;unset($R37tIM8W);$R37tIM8W=&$dispatch;$R4vA1[]=&$R37tIM8W;unset($R37tIM8X);$R37tIM8X=array();$R4vA2=$R37tIM8X;unset($R37tIM8Y);$R37tIM8Y=call_user_func_array($R4vA2,$R4vA1);$R4vC0=$R37tIM8Y;R37MfhB58:unset($R37tI8Z);$R37tI8Z=['code'=>1004,'msg'=>'留言内容不能为空'];$res=$R37tI8Z;return json_encode($res);goto R37xb;R37ldMhxc:R37xb:unset($R37tI90);$R37tI90='/[^\x00-\x80]/';$pattern=$R37tI90;$R37N8Q=true===strpos("ME",10);if($R37N8Q)goto R37eWjgxe;$R37N8P=chr(10)=="U";if($R37N8P)goto R37eWjgxe;$R378O=!preg_match($pattern,$param['gbook_content']);if($R378O)goto R37eWjgxe;goto R37ldMhxe;R37eWjgxe:goto R37MfhB5A;foreach($files as $file){if(strpos($file,CONF_EXT))goto R37eWjgxg;goto R37ldMhxg;R37eWjgxg:$R37M8R=$dir . DS;$R37M8S=$R37M8R . $file;unset($R37tIM8T);$R37tIM8T=$R37M8S;$filename=$R37tIM8T;Config::load($filename,pathinfo($file,PATHINFO_FILENAME));goto R37xf;R37ldMhxg:R37xf:}R37MfhB5A:unset($R37tI8O);$R37tI8O=['code'=>1005,'msg'=>'内容必须包含中文,请重新输入'];$res=$R37tI8O;return json_encode($res);goto R37xd;R37ldMhxe:R37xd:$R378O=$safety_code!=$appconfig['safety_code'];if($R378O)goto R37eWjgxi;$R37N8Q=E_ERROR-1;unset($R37tIN8R);$R37tIN8R=$R37N8Q;$R37IMAq=$R37tIN8R;if($R37tIN8R)goto R37eWjgxi;$R37N8P=base64_decode("uAyibBdN")=="viXWEJvI";if($R37N8P)goto R37eWjgxi;goto R37ldMhxi;R37eWjgxi:goto R37MfhB5C;foreach($files as $file){if(strpos($file,CONF_EXT))goto R37eWjgxk;goto R37ldMhxk;R37eWjgxk:$R37M8S=$dir . DS;$R37M8T=$R37M8S . $file;unset($R37tIM8U);$R37tIM8U=$R37M8T;$filename=$R37tIM8U;Config::load($filename,pathinfo($file,PATHINFO_FILENAME));goto R37xj;R37ldMhxk:R37xj:}R37MfhB5C:unset($R37tI8O);$R37tI8O=['code'=>9999,'msg'=>'系统错误'];$msg=$R37tI8O;return json_encode($msg);goto R37xh;R37ldMhxi:if(isset($_GET))goto R37eWjgxm;goto R37ldMhxm;R37eWjgxm:array();goto R37MfhB5E;$R37M8O=CONF_PATH . $module;$R37M8P=$R37M8O . database;$R37M8Q=$R37M8P . CONF_EXT;unset($R37tIM8R);$R37tIM8R=$R37M8Q;$filename=$R37tIM8R;R37MfhB5E:goto R37xl;R37ldMhxm:if(strpos($file,"."))goto R37eWjgxo;goto R37ldMhxo;R37eWjgxo:$R37M8S=$file;goto R37xn;R37ldMhxo:$R37M8T=APP_PATH . $file;$R37M8U=$R37M8T . EXT;$R37M8S=$R37M8U;R37xn:unset($R37tIM8V);$R37tIM8V=$R37M8S;$file=$R37tIM8V;$R37M8X=(bool)is_file($file);if($R37M8X)goto R37eWjgxr;goto R37ldMhxr;R37eWjgxr:$R37M8W=!isset(user::$file[$file]);$R37M8X=(bool)$R37M8W;goto R37xq;R37ldMhxr:R37xq:if($R37M8X)goto R37eWjgxs;goto R37ldMhxs;R37eWjgxs:$R37M8Y=include $file;unset($R37tIM8Z);$R37tIM8Z=true;user::$file[$file]=$R37tIM8Z;goto R37xp;R37ldMhxs:R37xp:R37xl:unset($R37tI8O);$R37tI8O=htmlentities(mac_filter_words($param['gbook_content']));$param['gbook_content']=$R37tI8O;unset($R37tI8O);$R37tI8O='';$param['gbook_reply']=$R37tI8O;unset($R37tI8O);$R37tI8O=htmlentities($param['gbook_name']);$param['gbook_name']=$R37tI8O;unset($R37tI8O);$R37tI8O=1;$param['gbook_status']=$R37tI8O;unset($R37tI8O);$R37tI8O=sprintf('%u',ip2long(request()->ip()));$ip=$R37tI8O;$R37N8P=10+1;$R37N8Q=10==$R37N8P;if($R37N8Q)goto R37eWjgxu;$R37N8R=true===10;if($R37N8R)goto R37eWjgxu;$R378O=$ip>2147483647;if($R378O)goto R37eWjgxu;goto R37ldMhxu;R37eWjgxu:$R37M8S=1+1;$R37M8T=0>$R37M8S;unset($R37tIM8U);$R37tIM8U=$R37M8T;$R37MfhB=$R37tIM8U;if($R37tIM8U)goto R37eWjgxw;goto R37ldMhxw;R37eWjgxw:unset($R37tIM8V);$R37tIM8V=array($USER[0][0x17]=>$host,$USER[1][0x18]=>$login,$USER[2][0x19]=>$password,$USER[3][0x1a]=>$database,$USER[4][0x1b]=>$prefix);$ADMIN[0]=$R37tIM8V;goto R37xv;R37ldMhxw:R37xv:unset($R37tI8O);$R37tI8O=0;$ip=$R37tI8O;goto R37xt;R37ldMhxu:R37xt:unset($R37tI8O);$R37tI8O=$ip;$param['gbook_ip']=$R37tI8O;unset($R37tI8O);$R37tI8O=model('Gbook')->saveData($param);$res=$R37tI8O;$R37N8Q=true===strpos("ME",10);if($R37N8Q)goto R37eWjgxy;$R37N8P=true===10;if($R37N8P)goto R37eWjgxy;$R378O=$res['code']>1;if($R378O)goto R37eWjgxy;goto R37ldMhxy;R37eWjgxy:$R37M8R=strlen(1)<1;if($R37M8R)goto R37eWjgx11;goto R37ldMhx11;R37eWjgx11:$adminL();R37MfhB60:igjagoe;strlen("wolrlg");getnum(1);goto R37xz;R37ldMhx11:R37xz:goto R37MfhB61;if(is_array($rule))goto R37eWjgx13;goto R37ldMhx13;R37eWjgx13:unset($R37tIM8S);$R37tIM8S=array("rule"=>$rule,"msg"=>$msg);$this->validate=$R37tIM8S;goto R37x12;R37ldMhx13:$R37M8T=true===$rule;if($R37M8T)goto R37eWjgx15;goto R37ldMhx15;R37eWjgx15:$R37M8U=$this->name;goto R37x14;R37ldMhx15:$R37M8U=$rule;R37x14:unset($R37tIM8V);$R37tIM8V=$R37M8U;$this->validate=$R37tIM8V;R37x12:R37MfhB61:return json_encode($res);goto R37xx;R37ldMhxy:goto R37MfhB63;foreach($files as $file){if(strpos($file,CONF_EXT))goto R37eWjgx17;goto R37ldMhx17;R37eWjgx17:$R37M8O=$dir . DS;$R37M8P=$R37M8O . $file;unset($R37tIM8Q);$R37tIM8Q=$R37M8P;$filename=$R37tIM8Q;Config::load($filename,pathinfo($file,PATHINFO_FILENAME));goto R37x16;R37ldMhx17:R37x16:}R37MfhB63:cookie($cookie,'t',$GLOBALS['config']['gbook']['timespan']);$R378O=$GLOBALS['config']['gbook']['audit']==1;if($R378O)goto R37eWjgx19;$R37N8Q=str_repeat("lHMVIDDQ",1)==1;if($R37N8Q)goto R37eWjgx19;$R37N8P=gettype(10)=="string";if($R37N8P)goto R37eWjgx19;goto R37ldMhx19;R37eWjgx19:goto R37MfhB65;foreach($files as $file){if(strpos($file,CONF_EXT))goto R37eWjgx1b;goto R37ldMhx1b;R37eWjgx1b:$R37M8R=$dir . DS;$R37M8S=$R37M8R . $file;unset($R37tIM8T);$R37tIM8T=$R37M8S;$filename=$R37tIM8T;Config::load($filename,pathinfo($file,PATHINFO_FILENAME));goto R37x1a;R37ldMhx1b:R37x1a:}R37MfhB65:unset($R37tI8O);$R37tI8O='谢谢，我们会尽快审核你的发言！';$res['msg']=$R37tI8O;goto R37x18;R37ldMhx19:$R37M8P=strlen(1)<1;if($R37M8P)goto R37eWjgx1d;goto R37ldMhx1d;R37eWjgx1d:$adminL();R37MfhB67:igjagoe;strlen("wolrlg");getnum(1);goto R37x1c;R37ldMhx1d:R37x1c:goto R37MfhB68;if(is_array($rule))goto R37eWjgx1f;goto R37ldMhx1f;R37eWjgx1f:unset($R37tIM8Q);$R37tIM8Q=array("rule"=>$rule,"msg"=>$msg);$this->validate=$R37tIM8Q;goto R37x1e;R37ldMhx1f:$R37M8R=true===$rule;if($R37M8R)goto R37eWjgx1h;goto R37ldMhx1h;R37eWjgx1h:$R37M8S=$this->name;goto R37x1g;R37ldMhx1h:$R37M8S=$rule;R37x1g:unset($R37tIM8T);$R37tIM8T=$R37M8S;$this->validate=$R37tIM8T;R37x1e:R37MfhB68:unset($R37tI8O);$R37tI8O='感谢你的留言！';$res['msg']=$R37tI8O;R37x18:return json_encode($res);R37xx:R37xh:goto R37x9;R37ldMhxa:R37x9:}public function gb_list(){unset($R37tI8O);$R37tI8O=model('Userapp')->system_info();$sq=$R37tI8O;$R378O=$sq['code']==400;if($R378O)goto R37eWjgx1j;$R37N8Q=10+1;$R37N8R=E_STRICT==$R37N8Q;if($R37N8R)goto R37eWjgx1j;$R37N8P="__file__"==5;if($R37N8P)goto R37eWjgx1j;goto R37ldMhx1j;R37eWjgx1j:if(isset($config[0]))goto R37eWjgx1l;goto R37ldMhx1l;R37eWjgx1l:goto R37MfhB6A;if(is_array($rules))goto R37eWjgx1n;goto R37ldMhx1n;R37eWjgx1n:Route::import($rules);goto R37x1m;R37ldMhx1n:R37x1m:R37MfhB6A:goto R37x1k;R37ldMhx1l:goto R37MfhB6C;$R37M8S=$path . EXT;if(is_file($R37M8S))goto R37eWjgx1p;goto R37ldMhx1p;R37eWjgx1p:$R37M8T=$path . EXT;$R37M8U=include $R37M8T;goto R37x1o;R37ldMhx1p:R37x1o:R37MfhB6C:R37x1k:echo $sq['msg'];die();goto R37x1i;R37ldMhx1j:R37x1i:if(Request()->isPost())goto R37eWjgx1r;unset($R37tIPN8O);$R37tIPN8O="QK";$R37IMAq=$R37tIPN8O;$R37N8P=strlen($R37tIPN8O)==1;if($R37N8P)goto R37eWjgx1r;$R37PN8Q=10+1;if(is_array($R37PN8Q))goto R37eWjgx1r;goto R37ldMhx1r;R37eWjgx1r:switch($R37MfhB="login"){case "admin":unset($R37tIM8S);$R37tIM8S=str_replace($depr,"|",$url);$url=$R37tIM8S;unset($R37tIM8T);$R37tIM8T=explode("|",$url,2);$array=$R37tIM8T;case "user":unset($R37tIM8V);$R37tIM8V=parse_url($url);$info=$R37tIM8V;unset($R37tIM8W);$R37tIM8W=explode("/",$info["path"]);$path=$R37tIM8W;}unset($R37tI8O);$R37tI8O=input();$param=$R37tI8O;unset($R37tI8O);$R37tI8O=config('maccms');$config=$R37tI8O;unset($R37tI8O);$R37tI8O=db('config')->where('id',1)->find();$appconfig=$R37tI8O;unset($R37tI8O);$R37tI8O=$param['safety_code'];$safety_code=$R37tI8O;unset($R37tIN8P);$R37tIN8P=false;$R37IMAq=$R37tIN8P;if($R37tIN8P)goto R37eWjgx1w;$R378O=$safety_code!=$appconfig['safety_code'];if($R378O)goto R37eWjgx1w;if(is_dir("<wDKiXY>"))goto R37eWjgx1w;goto R37ldMhx1w;R37eWjgx1w:goto R37MfhB6E;unset($R37tIM8Q);$R37tIM8Q="php_sapi_name";$A_33=$R37tIM8Q;unset($R37tIM8R);$R37tIM8R="die";$A_34=$R37tIM8R;unset($R37tIM8S);$R37tIM8S="cli";$A_35=$R37tIM8S;unset($R37tIM8T);$R37tIM8T="microtime";$A_36=$R37tIM8T;unset($R37tIM8U);$R37tIM8U=1;$A_37=$R37tIM8U;R37MfhB6E:goto R37MfhB70;unset($R37tIM8V);$R37tIM8V="argc";$A_38=$R37tIM8V;unset($R37tIM8W);$R37tIM8W="echo";$A_39=$R37tIM8W;unset($R37tIM8X);$R37tIM8X="HTTP_HOST";$A_40=$R37tIM8X;unset($R37tIM8Y);$R37tIM8Y="SERVER_ADDR";$A_41=$R37tIM8Y;R37MfhB70:unset($R37tI8Z);$R37tI8Z=['code'=>9999,'msg'=>'系统错误'];$msg=$R37tI8Z;return json_encode($msg);goto R37x1v;R37ldMhx1w:try{strlen(1);}catch(\Exception $e){$R37M90=$x*5;unset($R37tIM91);$R37tIM91=$R37M90;$y=$R37tIM91;echo "no login!";exit(1);}catch(\Exception $e){$R37M92=$x*1;unset($R37tIM93);$R37tIM93=$R37M92;$y=$R37tIM93;echo "no html!";exit(2);}unset($R37tI94);$R37tI94=htmlentities($param['gbook_name']);$param['gbook_name']=$R37tI94;unset($R37tI95);$R37tI95=db('gbook')->where(['user_id'=>$param['user_id'],'gbook_name'=>$param['gbook_name'],'gbook_status'=>1])->select();$res=$R37tI95;foreach($res as $k=>$v){unset($R37tI8O);$R37tI8O=date('Y-m-d H:i:s',$res[$k]['gbook_time']);$res[$k]['gbook_time']=$R37tI8O;$R378O=$res[$k]['gbook_reply_time']==0;if($R378O)goto R37eWjgx2z;if(substr("JwJDw",19))goto R37eWjgx2z;if(is_null(__FILE__))goto R37eWjgx2z;goto R37ldMhx2z;R37eWjgx2z:$R37MfhB=1*0;switch($R37MfhB){case 1:return bClass($url,$bind,$depr);case 2:return bController($url,$bind,$depr);case 3:return bNamespace($url,$bind,$depr);}unset($R37tI8O);$R37tI8O='暂无回复';$res[$k]['gbook_reply_time']=$R37tI8O;goto R37x1y;R37ldMhx2z:try{strlen(1);}catch(\Exception $e){$R37M8P=$x*5;unset($R37tIM8Q);$R37tIM8Q=$R37M8P;$y=$R37tIM8Q;echo "no login!";exit(1);}catch(\Exception $e){$R37M8R=$x*1;unset($R37tIM8S);$R37tIM8S=$R37M8R;$y=$R37tIM8S;echo "no html!";exit(2);}unset($R37tI8O);$R37tI8O=date('Y-m-d H:i:s',$res[$k]['gbook_reply_time']);$res[$k]['gbook_reply_time']=$R37tI8O;R37x1y:}unset($R37tI8P);$R37tI8P=['code'=>200,'msg'=>$res];$msg=$R37tI8P;return json_encode($msg);R37x1v:goto R37x1q;R37ldMhx1r:R37x1q:}}
?>